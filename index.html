<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#3b82f6">
    <title>Goal Tracker PWA</title>
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlBlcnNvbmFsIEdvYWwgVHJhY2tlciIsCiAgInNob3J0X25hbWUiOiAiR29hbCBUcmFja2VyIiwKICAic3RhcnRfdXJsIjogIi4vaW5kZXguaHRtbCIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2ZmZmZmZiIsCiAgInRoZW1lX2NvbG9yIjogIiMzYjgyZjYiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlkWFJtTFRnaVB6NDhkR1Y0ZENCNGJXZ3RjR0ZuWlQwaWMybDZaU0krUEhaaGJHbGtJR1pwYkd3OUluVnliQ2d4TURBc01UQXdLU0l2UGp4bWNtVnhkV1Z1WTJVdWMzWm5JR1ZtYVd4c1BTSmpiR0Z6YzBCaWJIVmxMVFF3TUNJdlBqeGpJR05zWVhOelBTSm1hV3hzSUdKc2RXVkFOREF3SWo0OGNHRjBhQ0J6ZEhsc1pUMGlkMmwwYUNCdFlYTnJPaUIxY213b01UQXdMREV3TUNrZ1ptbHNiRG9nWTJ4aGMzTTlJbVpwYkd3Z1lteDFaVUEwTURBaUlEODhMM0JoZEdnK1BHTnlZV0RUcHVTNFVkT24wN3pUcFVJdWMzWm5JR05zWVhOelBTSm1hWGhsWkNCbGJtUnpJR04xY25abElDaHZkbVZ5Y21sa1pXNDZJR2hoZW1rcElHTnBjbU5zWlRvZ1luVjBkQ0J5T2lBeE15SStZblZrYUdWaGN6c2dabTFuZW5BN0lITjBjbTlyWlRzdlBqd3ZZejQ4TDNSbGVIUStQQzkyWVd4cFpENEtQR2x0WnlCemNtTTlJbTFsY3kxbmIyRnNMWFJ5WVdOclpYSXRhV052YmkxaWJIVmxMbkIxYmlJZ1lXeDBQU0pIYjJGc0lGUnlZV05yWlhJZ1JXMWliR1Z0SWlCM2FXUjBhRDBpTVRBd0lpQm9aV2xuYUhROUlqRXdNQ0lnYzNSNWJHVTlJbU5zYVhCd1lYUm9PaUIxY213b01UQXdMREV3TUNrZ1ptbHNiRG9nZFc1elpYUWdMbWdpTHo0OEwzTjJaejQ9IiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfSwKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlkWFJtTFRnaVB6NDhkR1Y0ZENCNGJXZ3RjR0ZuWlQwaWMybDZaU0krUEhaaGJHbGtJR1pwYkd3OUluVnliQ2d4TURBc01UQXdLU0l2UGp4bWNtVnhkV1Z1WTJVdWMzWm5JR1ZtYVd4c1BTSmpiR0Z6YzBCaWJIVmxMVFF3TUNJdlBqeGpJR05zWVhOelBTSm1hV3hzSUdKc2RXVkFOREF3SWo0OGNHRjBhQ0J6ZEhsc1pUMGlkMmwwYUNCdFlYTnJPaUIxY213b01UQXdMREV3TUNrZ1ptbHNiRG9nWTJ4aGMzTTlJbVpwYkd3Z1lteDFaVUEwTURBaUlEODhMM0JoZEdnK1BHTnlZV0RUcHVTNFVkT24wN3pUcFVJdWMzWm5JR05zWVhOelBTSm1hWGhsWkNCbGJtUnpJR04xY25abElDaHZkbVZ5Y21sa1pXNDZJR2hoZW1rcElHTnBjbU5zWlRvZ1luVjBkQ0J5T2lBeE15SStZblZrYUdWaGN6c2dabTFuZW5BN0lITjBjbTlyWlRzdlBqd3ZZejQ4TDNSbGVIUStQQzkyWVd4cFpENEtQR2x0WnlCemNtTTlJbTFsY3kxbmIyRnNMWFJ5WVdOclpYSXRhV052YmkxaWJIVmxMbkIxYmlJZ1lXeDBQU0pIYjJGc0lGUnlZV05yWlhJZ1JXMWliR1Z0SWlCM2FXUjBhRDBpTVRBd0lpQm9aV2xuYUhROUlqRXdNQ0lnYzNSNWJHVTlJbU5zYVhCd1lYUm9PaUIxY213b01UQXdMREV3TUNrZ1ptbHNiRG9nZFc1elpYUWdMbWdpTHo0OEwzTjJaejQ9IiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0sCiAgInNjb3BlIjogIi4vIgp9">
    
    <!-- PWA iOS Support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Goal Tracker">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzM4YmRmOCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjEwIj48L2NpcmNsZT48cGF0aCBkPSJNMTIgNnYxMiI+PC9wYXRoPjxwYXRoIGQ9Ik02IDEyaDEyIj48L3BhdGg+PC9zdmc+">

    <!-- Direct CSS instead of CDN Tailwind -->
    <style>
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        [x-cloak] { 
            display: none !important; 
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f3f4f6;
            color: #111827;
            line-height: 1.5;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior: contain;
            min-height: 100vh;
        }

        .container {
            padding: 1rem;
            max-width: 28rem;
            margin: 0 auto;
        }

        /* Card Styles */
        .card {
            background-color: white;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            background-color: #2563eb;
            color: white;
            padding: 1rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: bold;
            text-align: center;
        }

        /* Tab Styles */
        .tabs {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
        }

        .tab {
            flex: 1;
            padding: 0.75rem 1rem;
            text-align: center;
            font-weight: 500;
            transition: all 0.15s ease;
            cursor: pointer;
        }

        .tab-active {
            background-color: #eff6ff;
            border-bottom: 2px solid #2563eb;
        }

        .tab:not(.tab-active):hover {
            background-color: #f9fafb;
        }

        .tab-content {
            padding: 1rem;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.25rem;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 1rem;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
        }

        /* Button Styles */
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            border: none;
        }

        .btn-primary {
            background-color: #2563eb;
            color: white;
        }

        .btn-primary:hover {
            background-color: #1d4ed8;
        }

        .btn-secondary {
            background-color: #e5e7eb;
            color: #1f2937;
        }

        .btn-secondary:hover {
            background-color: #d1d5db;
        }

        .btn-group {
            display: flex;
            gap: 0.5rem;
        }

        .btn-flex {
            flex: 1;
        }

        /* Goal Item Styles */
        .empty-state {
            padding: 2rem 0;
            text-align: center;
            color: #6b7280;
        }

        .empty-icon {
            height: 4rem;
            width: 4rem;
            margin: 0 auto 1rem auto;
            color: #d1d5db;
        }

        .goals-list {
            display: flex; 
            flex-direction: column;
            gap: 1rem;
        }

        .goal-item {
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .goal-item-complete {
            background-color: #ecfdf5;
            border-color: #a7f3d0;
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }

        .goal-title {
            font-size: 1.125rem;
            font-weight: 500;
            color: #111827;
        }

        .goal-title-complete {
            text-decoration: line-through;
            color: #6b7280;
        }

        .goal-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.25rem;
        }

        .goal-category {
            background-color: #dbeafe;
            color: #1e40af;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
        }

        .goal-date {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .goal-actions {
            display: flex;
            gap: 0.25rem;
        }

        .action-btn {
            padding: 0.5rem;
            border-radius: 9999px;
            cursor: pointer;
            transition: background-color 0.15s ease;
        }

        .action-btn:hover {
            background-color: #f3f4f6;
        }

        .action-btn svg {
            height: 1.25rem;
            width: 1.25rem;
        }

        .action-complete {
            color: #059669;
        }

        .action-edit {
            color: #2563eb;
        }

        .action-delete {
            color: #dc2626;
        }

        /* Progress Bar */
        .progress-container {
            margin-top: 0.75rem;
        }

        .progress-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
        }

        .progress-track {
            background-color: #e5e7eb;
            border-radius: 9999px;
            height: 0.5rem;
            overflow: hidden;
        }

        .progress-bar {
            background-color: #3b82f6;
            height: 100%;
            border-radius: 9999px;
            transition: width 0.3s ease;
        }

        input[type="range"] {
            width: 100%;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <div x-data="goalTracker()" class="container" x-cloak>
        <div class="card">
            <!-- Header -->
            <div class="card-header">
                <h1 class="card-title">Personal Goal Tracker</h1>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <div 
                    @click="activeTab = 'goals'" 
                    :class="{'tab-active': activeTab === 'goals'}"
                    class="tab">
                    My Goals
                </div>
                <div 
                    @click="activeTab = 'add'" 
                    :class="{'tab-active': activeTab === 'add'}"
                    class="tab">
                    Add Goal
                </div>
            </div>

            <!-- Goals List Tab -->
            <div x-show="activeTab === 'goals'" class="tab-content">
                <div x-show="!goals.length" class="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" class="empty-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M12 8v4l3 3"></path>
                    </svg>
                    <p>No goals yet. Add your first goal to get started!</p>
                </div>

                <div x-show="goals.length" class="goals-list">
                    <template x-for="(goal, index) in goals" :key="index">
                        <div 
                            :class="{'goal-item-complete': goal.completed}"
                            class="goal-item">
                            
                            <!-- Goal header -->
                            <div class="goal-header">
                                <div>
                                    <h3 
                                        :class="{'goal-title-complete': goal.completed}"
                                        class="goal-title"
                                        x-text="goal.title">
                                    </h3>
                                    <div class="goal-meta">
                                        <span 
                                            class="goal-category"
                                            x-text="goal.category">
                                        </span>
                                        <template x-if="goal.deadline">
                                            <span class="goal-date" x-text="'Due: ' + goal.deadline"></span>
                                        </template>
                                    </div>
                                </div>
                                
                                <!-- Action buttons -->
                                <div class="goal-actions">
                                    <div 
                                        @click="toggleComplete(index)"
                                        :class="{'action-complete': goal.completed}"
                                        class="action-btn">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path x-show="!goal.completed" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            <path x-show="goal.completed" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" fill="currentColor" />
                                        </svg>
                                    </div>
                                    <div 
                                        @click="editGoal(index)"
                                        class="action-btn action-edit">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                        </svg>
                                    </div>
                                    <div 
                                        @click="deleteGoal(index)"
                                        class="action-btn action-delete">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Progress bar -->
                            <div class="progress-container">
                                <div class="progress-meta">
                                    <span>Progress</span>
                                    <span x-text="goal.progress + '%'"></span>
                                </div>
                                <div class="progress-track">
                                    <div 
                                        class="progress-bar" 
                                        :style="`width: ${goal.progress}%`">
                                    </div>
                                </div>
                                <input 
                                    type="range" 
                                    min="0" 
                                    max="100" 
                                    step="5"
                                    :value="goal.progress" 
                                    @input="updateProgress(index, $event.target.value)">
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Add/Edit Goal Tab -->
            <div x-show="activeTab === 'add'" class="tab-content">
                <form @submit.prevent="saveGoal()">
                    <div class="form-group">
                        <label class="form-label">Goal Title*</label>
                        <input
                            type="text"
                            x-model="formData.title"
                            placeholder="What do you want to achieve?"
                            class="form-input"
                            required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Category</label>
                        <select
                            x-model="formData.category"
                            class="form-select">
                            <option value="Personal">Personal</option>
                            <option value="Health">Health</option>
                            <option value="Career">Career</option>
                            <option value="Financial">Financial</option>
                            <option value="Education">Education</option>
                            <option value="Family">Family</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Target Date (Optional)</label>
                        <input
                            type="date"
                            x-model="formData.deadline"
                            class="form-input">
                    </div>
                    
                    <div x-show="formData.editing !== null" class="form-group">
                        <label class="form-label">
                            Progress: <span x-text="formData.progress + '%'"></span>
                        </label>
                        <input
                            type="range"
                            min="0"
                            max="100"
                            step="5"
                            x-model="formData.progress">
                    </div>
                    
                    <div class="btn-group">
                        <button
                            type="submit"
                            class="btn btn-primary btn-flex">
                            <span x-text="formData.editing !== null ? 'Update Goal' : 'Add Goal'"></span>
                        </button>
                        <button
                            x-show="formData.editing !== null"
                            type="button"
                            @click="cancelEdit()"
                            class="btn btn-secondary">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Alpine.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.10.3/cdn.min.js" defer></script>
    
    <!-- Main Script -->
    <script>
        function goalTracker() {
            return {
                goals: JSON.parse(localStorage.getItem('goals') || '[]'),
                activeTab: 'goals',
                formData: {
                    title: '',
                    category: 'Personal',
                    deadline: '',
                    progress: 0,
                    editing: null
                },
                
                init() {
                    this.$watch('goals', (val) => {
                        localStorage.setItem('goals', JSON.stringify(val));
                    });
                },
                
                saveGoal() {
                    if (!this.formData.title.trim()) return;
                    
                    const goalData = {
                        title: this.formData.title,
                        category: this.formData.category,
                        deadline: this.formData.deadline,
                        progress: parseInt(this.formData.progress),
                        completed: parseInt(this.formData.progress) === 100,
                        created: new Date().toLocaleDateString()
                    };
                    
                    if (this.formData.editing !== null) {
                        this.goals[this.formData.editing] = goalData;
                    } else {
                        this.goals.push(goalData);
                    }
                    
                    this.resetForm();
                    this.activeTab = 'goals';
                },
                
                editGoal(index) {
                    const goal = this.goals[index];
                    this.formData = {
                        title: goal.title,
                        category: goal.category,
                        deadline: goal.deadline,
                        progress: goal.progress,
                        editing: index
                    };
                    this.activeTab = 'add';
                },
                
                cancelEdit() {
                    this.resetForm();
                },
                
                resetForm() {
                    this.formData = {
                        title: '',
                        category: 'Personal',
                        deadline: '',
                        progress: 0,
                        editing: null
                    };
                },
                
                deleteGoal(index) {
                    if (confirm('Are you sure you want to delete this goal?')) {
                        this.goals.splice(index, 1);
                    }
                },
                
                updateProgress(index, value) {
                    value = parseInt(value);
                    this.goals[index].progress = value;
                    this.goals[index].completed = value === 100;
                },
                
                toggleComplete(index) {
                    this.goals[index].completed = !this.goals[index].completed;
                    this.goals[index].progress = this.goals[index].completed ? 100 : 0;
                }
            };
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                // Create a Blob containing the service worker code
                const swCode = `
                    const CACHE_NAME = 'goal-tracker-v1';
                    const urlsToCache = [
                        './',
                        './index.html'
                    ];

                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => {
                                    return cache.addAll(urlsToCache);
                                })
                        );
                    });

                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => {
                                    if (response) {
                                        return response;
                                    }
                                    return fetch(event.request);
                                })
                        );
                    });
                `;
                
                const blob = new Blob([swCode], {type: 'text/javascript'});
                const swURL = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swURL)
                    .then(reg => {
                        console.log('Service Worker registered with scope:', reg.scope);
                    })
                    .catch(err => {
                        console.error('Service Worker registration failed:', err);
                    });
            });
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#3b82f6">
    <title>Goal Tracker PWA</title>
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlBlcnNvbmFsIEdvYWwgVHJhY2tlciIsCiAgInNob3J0X25hbWUiOiAiR29hbCBUcmFja2VyIiwKICAic3RhcnRfdXJsIjogIi4vaW5kZXguaHRtbCIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2ZmZmZmZiIsCiAgInRoZW1lX2NvbG9yIjogIiMzYjgyZjYiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlkWFJtTFRnaVB6NDhkR1Y0ZENCNGJXZ3RjR0ZuWlQwaWMybDZaU0krUEhaaGJHbGtJR1pwYkd3OUluVnliQ2d4TURBc01UQXdLU0l2UGp4bWNtVnhkV1Z1WTJVdWMzWm5JR1ZtYVd4c1BTSmpiR0Z6YzBCaWJIVmxMVFF3TUNJdlBqeGpJR05zWVhOelBTSm1hV3hzSUdKc2RXVkFOREF3SWo0OGNHRjBhQ0J6ZEhsc1pUMGlkMmwwYUNCdFlYTnJPaUIxY213b01UQXdMREV3TUNrZ1ptbHNiRG9nWTJ4aGMzTTlJbVpwYkd3Z1lteDFaVUEwTURBaUlEODhMM0JoZEdnK1BHTnlZV0RUcHVTNFVkT24wN3pUcFVJdWMzWm5JR05zWVhOelBTSm1hWGhsWkNCbGJtUnpJR04xY25abElDaHZkbVZ5Y21sa1pXNDZJR2hoZW1rcElHTnBjbU5zWlRvZ1luVjBkQ0J5T2lBeE15SStZblZrYUdWaGN6c2dabTFuZW5BN0lITjBjbTlyWlRzdlBqd3ZZejQ4TDNSbGVIUStQQzkyWVd4cFpENEtQR2x0WnlCemNtTTlJbTFsY3kxbmIyRnNMWFJ5WVdOclpYSXRhV052YmkxaWJIVmxMbkIxYmlJZ1lXeDBQU0pIYjJGc0lGUnlZV05yWlhJZ1JXMWliR1Z0SWlCM2FXUjBhRDBpTVRBd0lpQm9aV2xuYUhROUlqRXdNQ0lnYzNSNWJHVTlJbU5zYVhCd1lYUm9PaUIxY213b01UQXdMREV3TUNrZ1ptbHNiRG9nZFc1elpYUWdMbWdpTHo0OEwzTjJaejQ9IiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfSwKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlkWFJtTFRnaVB6NDhkR1Y0ZENCNGJXZ3RjR0ZuWlQwaWMybDZaU0krUEhaaGJHbGtJR1pwYkd3OUluVnliQ2d4TURBc01UQXdLU0l2UGp4bWNtVnhkV1Z1WTJVdWMzWm5JR1ZtYVd4c1BTSmpiR0Z6YzBCaWJIVmxMVFF3TUNJdlBqeGpJR05zWVhOelBTSm1hV3hzSUdKc2RXVkFOREF3SWo0OGNHRjBhQ0J6ZEhsc1pUMGlkMmwwYUNCdFlYTnJPaUIxY213b01UQXdMREV3TUNrZ1ptbHNiRG9nWTJ4aGMzTTlJbVpwYkd3Z1lteDFaVUEwTURBaUlEODhMM0JoZEdnK1BHTnlZV0RUcHVTNFVkT24wN3pUcFVJdWMzWm5JR05zWVhOelBTSm1hWGhsWkNCbGJtUnpJR04xY25abElDaHZkbVZ5Y21sa1pXNDZJR2hoZW1rcElHTnBjbU5zWlRvZ1luVjBkQ0J5T2lBeE15SStZblZrYUdWaGN6c2dabTFuZW5BN0lITjBjbTlyWlRzdlBqd3ZZejQ4TDNSbGVIUStQQzkyWVd4cFpENEtQR2x0WnlCemNtTTlJbTFsY3kxbmIyRnNMWFJ5WVdOclpYSXRhV052YmkxaWJIVmxMbkIxYmlJZ1lXeDBQU0pIYjJGc0lGUnlZV05yWlhJZ1JXMWliR1Z0SWlCM2FXUjBhRDBpTVRBd0lpQm9aV2xuYUhROUlqRXdNQ0lnYzNSNWJHVTlJbU5zYVhCd1lYUm9PaUIxY213b01UQXdMREV3TUNrZ1ptbHNiRG9nZFc1elpYUWdMbWdpTHo0OEwzTjJaejQ9IiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0sCiAgInNjb3BlIjogIi4vIgp9">
    
    <!-- PWA iOS Support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Goal Tracker">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzM4YmRmOCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjEwIj48L2NpcmNsZT48cGF0aCBkPSJNMTIgNnYxMiI+PC9wYXRoPjxwYXRoIGQ9Ik02IDEyaDEyIj48L3BhdGg+PC9zdmc+">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    
    <style>
        [x-cloak] { display: none !important; }
        .progress-bar {
            transition: width 0.3s ease;
        }
        body {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior: contain;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div x-data="goalTracker()" class="p-4 max-w-md mx-auto" x-cloak>
        <div class="bg-white shadow rounded-xl overflow-hidden">
            <!-- Header -->
            <div class="bg-blue-600 text-white p-4">
                <h1 class="text-xl font-bold text-center">Personal Goal Tracker</h1>
            </div>

            <!-- Tabs -->
            <div class="flex border-b">
                <button 
                    @click="activeTab = 'goals'" 
                    :class="{'bg-blue-50 border-b-2 border-blue-600': activeTab === 'goals', 'hover:bg-gray-50': activeTab !== 'goals'}"
                    class="flex-1 py-3 px-4 text-center font-medium transition">
                    My Goals
                </button>
                <button 
                    @click="activeTab = 'add'" 
                    :class="{'bg-blue-50 border-b-2 border-blue-600': activeTab === 'add', 'hover:bg-gray-50': activeTab !== 'add'}"
                    class="flex-1 py-3 px-4 text-center font-medium transition">
                    Add Goal
                </button>
            </div>

            <!-- Goals List Tab -->
            <div x-show="activeTab === 'goals'" class="p-4">
                <div x-show="!goals.length" class="py-8 text-center text-gray-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M12 8v4l3 3"></path>
                    </svg>
                    <p>No goals yet. Add your first goal to get started!</p>
                </div>

                <div x-show="goals.length" class="space-y-4">
                    <template x-for="(goal, index) in goals" :key="index">
                        <div 
                            :class="{'bg-green-50 border-green-200': goal.completed, 'bg-white': !goal.completed}"
                            class="border rounded-lg p-4 shadow-sm relative">
                            
                            <!-- Goal header -->
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h3 
                                        :class="{'line-through text-gray-500': goal.completed, 'text-gray-900': !goal.completed}"
                                        class="text-lg font-medium"
                                        x-text="goal.title">
                                    </h3>
                                    <div class="flex flex-wrap gap-2 mt-1">
                                        <span 
                                            class="bg-blue-100 text-blue-800 px-2 py-1 text-xs rounded"
                                            x-text="goal.category">
                                        </span>
                                        <template x-if="goal.deadline">
                                            <span class="text-xs text-gray-500" x-text="'Due: ' + goal.deadline"></span>
                                        </template>
                                    </div>
                                </div>
                                
                                <!-- Action buttons -->
                                <div class="flex space-x-1">
                                    <button 
                                        @click="toggleComplete(index)"
                                        :class="{'text-green-600': goal.completed, 'text-gray-400': !goal.completed}"
                                        class="p-2 rounded-full hover:bg-gray-100">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path x-show="!goal.completed" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            <path x-show="goal.completed" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" fill="currentColor" />
                                        </svg>
                                    </button>
                                    <button 
                                        @click="editGoal(index)"
                                        class="p-2 rounded-full hover:bg-gray-100 text-blue-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                        </svg>
                                    </button>
                                    <button 
                                        @click="deleteGoal(index)"
                                        class="p-2 rounded-full hover:bg-gray-100 text-red-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Progress bar -->
                            <div class="mt-3">
                                <div class="flex justify-between text-xs text-gray-500 mb-1">
                                    <span>Progress</span>
                                    <span x-text="goal.progress + '%'"></span>
                                </div>
                                <div class="bg-gray-200 rounded-full h-2 overflow-hidden">
                                    <div 
                                        class="progress-bar bg-blue-500 h-full rounded-full" 
                                        :style="`width: ${goal.progress}%`">
                                    </div>
                                </div>
                                <input 
                                    type="range" 
                                    min="0" 
                                    max="100" 
                                    step="5"
                                    :value="goal.progress" 
                                    @input="updateProgress(index, $event.target.value)"
                                    class="w-full mt-2">
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Add/Edit Goal Tab -->
            <div x-show="activeTab === 'add'" class="p-4">
                <form @submit.prevent="saveGoal()" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Goal Title*</label>
                        <input
                            type="text"
                            x-model="formData.title"
                            placeholder="What do you want to achieve?"
                            class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                        <select
                            x-model="formData.category"
                            class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="Personal">Personal</option>
                            <option value="Health">Health</option>
                            <option value="Career">Career</option>
                            <option value="Financial">Financial</option>
                            <option value="Education">Education</option>
                            <option value="Family">Family</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Target Date (Optional)</label>
                        <input
                            type="date"
                            x-model="formData.deadline"
                            class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div x-show="formData.editing !== null">
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Progress: <span x-text="formData.progress + '%'"></span>
                        </label>
                        <input
                            type="range"
                            min="0"
                            max="100"
                            step="5"
                            x-model="formData.progress"
                            class="w-full">
                    </div>
                    
                    <div class="flex space-x-2">
                        <button
                            type="submit"
                            class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition">
                            <span x-text="formData.editing !== null ? 'Update Goal' : 'Add Goal'"></span>
                        </button>
                        <button
                            x-show="formData.editing !== null"
                            type="button"
                            @click="cancelEdit()"
                            class="bg-gray-200 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-300 transition">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Alpine.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.10.3/cdn.min.js" defer></script>
    
    <!-- Main Script -->
    <script>
        function goalTracker() {
            return {
                goals: JSON.parse(localStorage.getItem('goals') || '[]'),
                activeTab: 'goals',
                formData: {
                    title: '',
                    category: 'Personal',
                    deadline: '',
                    progress: 0,
                    editing: null
                },
                
                init() {
                    this.$watch('goals', (val) => {
                        localStorage.setItem('goals', JSON.stringify(val));
                    });
                },
                
                saveGoal() {
                    if (!this.formData.title.trim()) return;
                    
                    const goalData = {
                        title: this.formData.title,
                        category: this.formData.category,
                        deadline: this.formData.deadline,
                        progress: parseInt(this.formData.progress),
                        completed: parseInt(this.formData.progress) === 100,
                        created: new Date().toLocaleDateString()
                    };
                    
                    if (this.formData.editing !== null) {
                        this.goals[this.formData.editing] = goalData;
                    } else {
                        this.goals.push(goalData);
                    }
                    
                    this.resetForm();
                    this.activeTab = 'goals';
                },
                
                editGoal(index) {
                    const goal = this.goals[index];
                    this.formData = {
                        title: goal.title,
                        category: goal.category,
                        deadline: goal.deadline,
                        progress: goal.progress,
                        editing: index
                    };
                    this.activeTab = 'add';
                },
                
                cancelEdit() {
                    this.resetForm();
                },
                
                resetForm() {
                    this.formData = {
                        title: '',
                        category: 'Personal',
                        deadline: '',
                        progress: 0,
                        editing: null
                    };
                },
                
                deleteGoal(index) {
                    if (confirm('Are you sure you want to delete this goal?')) {
                        this.goals.splice(index, 1);
                    }
                },
                
                updateProgress(index, value) {
                    value = parseInt(value);
                    this.goals[index].progress = value;
                    this.goals[index].completed = value === 100;
                },
                
                toggleComplete(index) {
                    this.goals[index].completed = !this.goals[index].completed;
                    this.goals[index].progress = this.goals[index].completed ? 100 : 0;
                }
            };
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                // Create a Blob containing the service worker code
                const swCode = `
                    const CACHE_NAME = 'goal-tracker-v1';
                    const urlsToCache = [
                        './',
                        './index.html'
                    ];

                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => {
                                    return cache.addAll(urlsToCache);
                                })
                        );
                    });

                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => {
                                    if (response) {
                                        return response;
                                    }
                                    return fetch(event.request);
                                })
                        );
                    });
                `;
                
                const blob = new Blob([swCode], {type: 'text/javascript'});
                const swURL = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swURL)
                    .then(reg => {
                        console.log('Service Worker registered with scope:', reg.scope);
                    })
                    .catch(err => {
                        console.error('Service Worker registration failed:', err);
                    });
            });
        }
    </script>
</body>
</html>
